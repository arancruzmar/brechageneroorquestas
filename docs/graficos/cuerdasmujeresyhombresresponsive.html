<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8' />
    <title>Instrumentistas de cuerda en las orquestas europeas</title>
    <script src="https://d3js.org/d3.v3.min.js"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato"/>
    <style>
@import url("https://fonts.googleapis.com/css?family=Lato");
body {
  font-family: Lato;

}

svg {
    width: 100%;
    height: 100%;
    position: center;
    fill: #797D7F;
}

text{
    font-family: Lato;
}

.toolTip {
    font-family: Lato;
    position: absolute;
    display: none;
    width: auto;
    height: auto;
    background: none repeat scroll 0 0 white;
    border: 0 none;
  /*  border-radius: 8px 8px 8px 8px;*/
  /*  box-shadow: -3px 3px 15px #888888;*/
    color: #797D7F;
    font: 16px;
    padding: 5px;
    text-align: center;
}

.legend {
    font-family: Lato;
    font-size: 100%;
}

rect {
    stroke-width: 2;
}

text {
  font: 16px;
}

.axis text {
  font: 16px;
}

.axis path{
  fill: none;
  stroke: #797D7F;
}

.axis line {
  fill: none;
  stroke: #797D7F;
  shape-rendering: crispEdges;
}

.axis .tick line {
  stroke-width: 1;
  stroke: rgba(0, 0, 0, 0.2);
}

.axisHorizontal path{
  fill: none;
}

.axisHorizontal line {
  fill: none;
  stroke: #797D7F;
  shape-rendering: crispEdges;
}

.axisHorizontal .tick line {
  stroke-width: 1;
  stroke: rgba(0, 0, 0, 0.2);
}

.bar {
  fill: steelblue;
  fill-opacity: .9;
}

.x.axis path {
  display: none;
}

</style>
</head>
<body>

<script>


    var margin = {top: 75, right: 0, bottom: 80, left: 35};
    var width = 900 - margin.left - margin.right,
        height = 500 - margin.top - margin.bottom;

    var svg = d3.select("body").append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .call(responsivefy)
        .append("g")
        .attr("transform","translate(" + margin.left + "," + margin.top + ")");


        svg.append("text")
        .attr("x", 0)
        .attr("y", -70)
        .attr("dy", "0.71em")
        .style("font-family", "Lato")
        .style("font-size", "24px")
        .text("Mujeres y hombres en instrumentos de cuerda"); //  .text("Encuesta sobre la percepción de la composición de orquestas");


    var x0 = d3.scale.ordinal()
        .rangeRoundBands([0, width], .1);

    var x1 = d3.scale.ordinal();

    var y = d3.scale.linear()
        .range([height, 0]);

    var colorRange = d3.scale.category20();
    var color = d3.scale.ordinal()
      .range(["#AB81B1", "#98D0C2"]);

    var xAxis = d3.svg.axis()
        .scale(x0)
        .orient("bottom");

    var yAxis = d3.svg.axis()
        .scale(y)
        .orient("left")
        .tickFormat(d3.format());

    var divTooltip = d3.select("body").append("div").attr("class", "toolTip");







    dataset = JSON.parse("[{\"Frequency\":\"Alemania\",\"Data\":[{\"Name\":\"Mujeres\",\"Value\":30},{\"Name\":\"Hombres\",\"Value\":70}]},{\"Frequency\":\"Andorra\",\"Data\":[{\"Name\":\"Mujeres\",\"Value\":32},{\"Name\":\"Hombres\",\"Value\":68}]},{\"Frequency\":\"Armenia\",\"Data\":[{\"Name\":\"Mujeres\",\"Value\":60},{\"Name\":\"Hombres\",\"Value\":40}]},{\"Frequency\":\"Austria\",\"Data\":[{\"Name\":\"Mujeres\",\"Value\":26},{\"Name\":\"Hombres\",\"Value\":74}]},{\"Frequency\":\"Bélgica\",\"Data\":[{\"Name\":\"Mujeres\",\"Value\":47},{\"Name\":\"Hombres\",\"Value\":53}]},{\"Frequency\":\"Bosnia\",\"Data\":[{\"Name\":\"Mujeres\",\"Value\":75},{\"Name\":\"Hombres\",\"Value\":25}]},{\"Frequency\":\"Bulgaria\",\"Data\":[{\"Name\":\"Mujeres\",\"Value\":73},{\"Name\":\"Hombres\",\"Value\":27}]},{\"Frequency\":\"Croacia\",\"Data\":[{\"Name\":\"Mujeres\",\"Value\":46},{\"Name\":\"Hombres\",\"Value\":54}]},{\"Frequency\":\"Dinamarca\",\"Data\":[{\"Name\":\"Mujeres\",\"Value\":54},{\"Name\":\"Hombres\",\"Value\":46}]},{\"Frequency\":\"Escocia\",\"Data\":[{\"Name\":\"Mujeres\",\"Value\":59},{\"Name\":\"Hombres\",\"Value\":41}]},{\"Frequency\":\"Eslovaquia\",\"Data\":[{\"Name\":\"Mujeres\",\"Value\":39},{\"Name\":\"Hombres\",\"Value\":61}]},{\"Frequency\":\"Eslovenia\",\"Data\":[{\"Name\":\"Mujeres\",\"Value\":47},{\"Name\":\"Hombres\",\"Value\":53}]},{\"Frequency\":\"España\",\"Data\":[{\"Name\":\"Mujeres\",\"Value\":45},{\"Name\":\"Hombres\",\"Value\":55}]},{\"Frequency\":\"Estonia\",\"Data\":[{\"Name\":\"Mujeres\",\"Value\":62},{\"Name\":\"Hombres\",\"Value\":38}]},{\"Frequency\":\"Francia\",\"Data\":[{\"Name\":\"Mujeres\",\"Value\":42},{\"Name\":\"Hombres\",\"Value\":58}]},{\"Frequency\":\"Hungría\",\"Data\":[{\"Name\":\"Mujeres\",\"Value\":54},{\"Name\":\"Hombres\",\"Value\":46}]},{\"Frequency\":\"Inglaterra\",\"Data\":[{\"Name\":\"Mujeres\",\"Value\":47},{\"Name\":\"Hombres\",\"Value\":53}]},{\"Frequency\":\"Irlanda\",\"Data\":[{\"Name\":\"Mujeres\",\"Value\":61},{\"Name\":\"Hombres\",\"Value\":39}]},{\"Frequency\":\"Islandia\",\"Data\":[{\"Name\":\"Mujeres\",\"Value\":69},{\"Name\":\"Hombres\",\"Value\":31}]},{\"Frequency\":\"Italia\",\"Data\":[{\"Name\":\"Mujeres\",\"Value\":29},{\"Name\":\"Hombres\",\"Value\":71}]},{\"Frequency\":\"Letonia\",\"Data\":[{\"Name\":\"Mujeres\",\"Value\":73},{\"Name\":\"Hombres\",\"Value\":27}]},{\"Frequency\":\"Finlandia\",\"Data\":[{\"Name\":\"Mujeres\",\"Value\":45},{\"Name\":\"Hombres\",\"Value\":55}]},{\"Frequency\":\"Lituania\",\"Data\":[{\"Name\":\"Mujeres\",\"Value\":61},{\"Name\":\"Hombres\",\"Value\":39}]},{\"Frequency\":\"Luxemburgo\",\"Data\":[{\"Name\":\"Mujeres\",\"Value\":41},{\"Name\":\"Hombres\",\"Value\":59}]},{\"Frequency\":\"Malta\",\"Data\":[{\"Name\":\"Mujeres\",\"Value\":45},{\"Name\":\"Hombres\",\"Value\":55}]},{\"Frequency\":\"Mónaco\",\"Data\":[{\"Name\":\"Mujeres\",\"Value\":37},{\"Name\":\"Hombres\",\"Value\":63}]},{\"Frequency\":\"Montenegro\",\"Data\":[{\"Name\":\"Mujeres\",\"Value\":58},{\"Name\":\"Hombres\",\"Value\":42}]},{\"Frequency\":\"Noruega\",\"Data\":[{\"Name\":\"Mujeres\",\"Value\":50},{\"Name\":\"Hombres\",\"Value\":50}]},{\"Frequency\":\"Países Bajos\",\"Data\":[{\"Name\":\"Mujeres\",\"Value\":55},{\"Name\":\"Hombres\",\"Value\":45}]},{\"Frequency\":\"Polonia\",\"Data\":[{\"Name\":\"Mujeres\",\"Value\":46},{\"Name\":\"Hombres\",\"Value\":54}]},{\"Frequency\":\"Portugal\",\"Data\":[{\"Name\":\"Mujeres\",\"Value\":46},{\"Name\":\"Hombres\",\"Value\":54}]},{\"Frequency\":\"R.Checa\",\"Data\":[{\"Name\":\"Mujeres\",\"Value\":30},{\"Name\":\"Hombres\",\"Value\":70}]},{\"Frequency\":\"Rumania\",\"Data\":[{\"Name\":\"Mujeres\",\"Value\":58},{\"Name\":\"Hombres\",\"Value\":42}]},{\"Frequency\":\"Rusia\",\"Data\":[{\"Name\":\"Mujeres\",\"Value\":38},{\"Name\":\"Hombres\",\"Value\":62}]},{\"Frequency\":\"Serbia\",\"Data\":[{\"Name\":\"Mujeres\",\"Value\":51},{\"Name\":\"Hombres\",\"Value\":49}]},{\"Frequency\":\"Suecia\",\"Data\":[{\"Name\":\"Mujeres\",\"Value\":51},{\"Name\":\"Hombres\",\"Value\":49}]},{\"Frequency\":\"Suiza\",\"Data\":[{\"Name\":\"Mujeres\",\"Value\":50},{\"Name\":\"Hombres\",\"Value\":50}]},{\"Frequency\":\"Turquía\",\"Data\":[{\"Name\":\"Mujeres\",\"Value\":45},{\"Name\":\"Hombres\",\"Value\":55}]},{\"Frequency\":\"Ucrania\",\"Data\":[{\"Name\":\"Mujeres\",\"Value\":61},{\"Name\":\"Hombres\",\"Value\":39}]}]");
 /**("[{\"Frequency\":\"63Hz\",\"Data\":[{\"Name\":\"Noise power Lw db(A)\",\"Value\":46},{\"Name\":\"Noise pressure Lw db(A)\",\"Value\":32}]},{\"Frequency\":\"125Hz\",\"Data\":[{\"Name\":\"Noise power Lw db(A)\",\"Value\":48},{\"Name\":\"Noise pressure Lw db(A)\",\"Value\":34}]},{\"Frequency\":\"250Hz\",\"Data\":[{\"Name\":\"Noise power Lw db(A)\",\"Value\":57},{\"Name\":\"Noise pressure Lw db(A)\",\"Value\":42}]},{\"Frequency\":\"500Hz\",\"Data\":[{\"Name\":\"Noise power Lw db(A)\",\"Value\":59},{\"Name\":\"Noise pressure Lw db(A)\",\"Value\":44}]},{\"Frequency\":\"1000Hz\",\"Data\":[{\"Name\":\"Noise power Lw db(A)\",\"Value\":62},{\"Name\":\"Noise pressure Lw db(A)\",\"Value\":48}]},{\"Frequency\":\"2000Hz\",\"Data\":[{\"Name\":\"Noise power Lw db(A)\",\"Value\":62},{\"Name\":\"Noise pressure Lw db(A)\",\"Value\":47}]},{\"Frequency\":\"4000Hz\",\"Data\":[{\"Name\":\"Noise power Lw db(A)\",\"Value\":58},{\"Name\":\"Noise pressure Lw db(A)\",\"Value\":43}]},{\"Frequency\":\"8000Hz\",\"Data\":[{\"Name\":\"Noise power Lw db(A)\",\"Value\":48},{\"Name\":\"Noise pressure Lw db(A)\",\"Value\":34}]},{\"Frequency\":\"Total\",\"Data\":[{\"Name\":\"Noise power Lw db(A)\",\"Value\":67},{\"Name\":\"Noise pressure Lw db(A)\",\"Value\":53}]}]");*/


    var options = ["Mujeres", "Hombres"];

    dataset[dataset.length-1].Data.forEach(function(d){
        d.isTotal = true;
    });

    x0.domain(dataset.map(function(d) { return d.Frequency; }));
    x1.domain(options).rangeRoundBands([0, x0.rangeBand()]);
    y.domain([0, (d3.max(dataset, function(d) { return d3.max(d.Data, function(d) { return d.Value; }); })+30)]);

    svg.append("g")
        .attr("class", "x axis")
        .attr("transform", "translate(0," + height + ")")
        .call(xAxis)
        .selectAll("text")
         .attr("transform", "rotate(-65)")
         .attr("x", "-5")
         .attr("y", "-5")
         .style("text-anchor", "end");

    svg.append("g")
        .attr("class", "y axis")
        .call(yAxis)
        .append("text")
        .attr("transform", "rotate(180)")
        .attr("y", 9)
        .attr("x", 9)
        .attr("dy", ".51em")
        .style("text-anchor", "end")
        .text("%");


    var bar = svg.selectAll(".bar")
        .data(dataset)
        .enter().append("g")
        .attr("class", "rect")
        .attr("transform", function(d) { return "translate(" + x0(d.Frequency) + ",0)"; });

    bar.selectAll("rect")
        .data(function(d) { return d.Data; })
        .enter().append("rect")
        .attr("class","dbar")
        .attr("width", x1.rangeBand())
        .attr("x", function(d) { return x1(d.Name); })
        .attr("y", function(d) { return y(d.Value); })
        .attr("value", function(d){return d.Name;})
        .attr("height", function(d) { return height - y(d.Value); })
       .style("opacity", function(d) {if (d.isTotal){return 1} else {return 1} })
       .style("fill", function(d) { return color(d.Name); })
        .each(function(d){
            // this.outerHTML += '<text x="'+ (x1(d.Name) + 10) +'" y="'+ (y(d.Value) - 10) +'" dy=".35em">' + d.Value + '</text>';
        });

    // bar.selectAll("rect")
    //     .data(function(d) { return d.Data; })
    //     .enter().append("text")
    //     .attr("class","dval")
    //     .attr("x", function(d) { return x1(d.Name); })
    //     .attr("y", function(d) { return y(d.Value); })
    //     .attr("dy", ".35em")
    //     .style("text-anchor", "start")
    //     .text(function(d){ console.log(d);return d.Value});

    var dbar = svg.selectAll('.dbar');
    bar
        .on("mousemove", function(d){
            divTooltip.style("left", d3.event.pageX+10+"px");
            divTooltip.style("top", d3.event.pageY-25+"px");
            divTooltip.style("display", "inline-block");
            var x = d3.event.pageX, y = d3.event.pageY
            var elements = document.querySelectorAll(':hover');
            l = elements.length
            l = l-1
            elementData = elements[l].__data__;
            var activeBar = window.activeBar = elements[l];
            divTooltip.html((d.Frequency)+"<br>"+elementData.Name+"<br>"+elementData.Value+"%");
            d3.select(activeBar).style('opacity', 1);
        });
    bar
        .on("mouseout", function(d){
             divTooltip.style("display", "none");
            // d3.select(window.activeBar).style('opacity',0.5);
            // window.activeBar = {};
        });


    var legend = svg.selectAll(".legend")
        .data(options.slice())
        .enter().append("g")
        .attr("class", "legend")
        .attr("transform", function(d, i) { return "translate(0," + i * 25 + ")"; });

    legend.append("rect")
        .attr("x", width-300)
        .attr("y", -57)
        .attr("width", 18)
        .attr("height", 18)
        .style("fill", color);

    legend.append("text")
        .attr("x", width -275)
        .attr("y", -49)
        .attr("dy", ".35em")
        .style("text-anchor", "start")
        .text(function(d) { return d; });

        function responsivefy(svg) {
                  // get container + svg aspect ratio
                  var container = d3.select(svg.node().parentNode),
                      width = parseInt(svg.style("width")),
                      height = parseInt(svg.style("height")),
                      aspect = width / height;
                  // add viewBox and preserveAspectRatio properties,
                  // and call resize so that svg resizes on inital page load
                  svg.attr("viewBox", "0 0 " + width + " " + height)
                      .attr("preserveAspectRatio", "xMinYMid")
                      .call(resize);
                  // to register multiple listeners for same event type,
                  // you need to add namespace, i.e., 'click.foo'
                  // necessary if you call invoke this function for multiple svgs
                  // api docs: https://github.com/mbostock/d3/wiki/Selections#on
                  d3.select(window).on("resize." + container.attr("id"), resize);
                  // get width of container and resize svg to fit it
                  function resize() {
                      var targetWidth = parseInt(container.style("width"));
                      svg.attr("width", targetWidth);
                      svg.attr("height", Math.round(targetWidth / aspect));
                  }
                }




</script>
</body>
